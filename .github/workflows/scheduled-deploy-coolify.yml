name: Scheduled Deploy to Coolify

on:
  schedule:
    # í•œêµ­ì‹œê°„ ìì • (KST 00:00) = UTC 15:00 (ì „ë‚ )
    - cron: '0 15 * * *'
  workflow_dispatch:  # ìˆ˜ë™ ì‹¤í–‰ë„ ê°€ëŠ¥

jobs:
  deploy:
    name: Trigger Coolify Deployment
    runs-on: ubuntu-latest

    steps:
      - name: Trigger Coolify Deploy via Webhook
        run: |
          echo "Triggering Coolify deployment at $(date)"

          RESPONSE=$(curl -s -w "\n%{http_code}" -X GET \
            "${{ secrets.COOLIFY_WEBHOOK_URL }}" \
            -H "Content-Type: application/json")

          HTTP_CODE=$(echo "$RESPONSE" | tail -n1)
          BODY=$(echo "$RESPONSE" | head -n -1)

          echo "Response: $BODY"
          echo "HTTP Code: $HTTP_CODE"

          if [ "$HTTP_CODE" -ge 200 ] && [ "$HTTP_CODE" -lt 300 ]; then
            echo "âœ… Deployment triggered successfully!"
          else
            echo "âŒ Deployment trigger failed!"
            exit 1
          fi

      - name: Log deployment time
        run: |
          echo "ğŸ• Deployment triggered at: $(TZ='Asia/Seoul' date '+%Y-%m-%d %H:%M:%S KST')"
