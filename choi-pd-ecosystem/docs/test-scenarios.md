# 히어로 이미지 관리 시스템 테스트 시나리오

이 문서는 히어로 이미지 관리 시스템의 수동 및 자동 테스트 시나리오를 정의합니다.

## 목차
- [1. 기능 테스트 시나리오](#1-기능-테스트-시나리오)
- [2. 사용자 시나리오 테스트](#2-사용자-시나리오-테스트)
- [3. 엣지 케이스 및 에러 처리](#3-엣지-케이스-및-에러-처리)
- [4. 통합 테스트 시나리오](#4-통합-테스트-시나리오)
- [5. 성능 테스트 시나리오](#5-성능-테스트-시나리오)
- [6. 접근성 테스트 시나리오](#6-접근성-테스트-시나리오)
- [7. 보안 테스트 시나리오](#7-보안-테스트-시나리오)

---

## 1. 기능 테스트 시나리오

### 1.1 이미지 업로드 기본 기능

#### 시나리오 1.1.1: 정상적인 이미지 업로드
**목적**: 유효한 이미지를 성공적으로 업로드할 수 있는지 확인

**전제 조건**:
- Admin 페이지(`/admin/hero-images`)에 접근 가능
- 유효한 이미지 파일 준비 (JPG, 1920x1080, 1MB)

**테스트 단계**:
1. `/admin/hero-images` 페이지 접속
2. "새 이미지 업로드" 섹션에서 파일 선택 버튼 클릭
3. 준비된 이미지 파일 선택
4. Alt 텍스트 입력: "최범희 PD의 교육, 미디어, 작품 활동을 상징하는 이미지"
5. "자동 크롭" 체크박스 활성화 확인
6. "업로드 및 활성화" 버튼 클릭

**예상 결과**:
- ✅ 업로드 진행률 표시 (0% → 100%)
- ✅ "업로드 성공!" 메시지 표시
- ✅ 이미지 목록에 새 이미지 표시
- ✅ 새 이미지에 "활성" 배지 표시
- ✅ 홈페이지(`/`)에 새 히어로 이미지 표시

---

#### 시나리오 1.1.2: WebP 형식 이미지 업로드
**목적**: WebP 형식의 이미지를 업로드할 수 있는지 확인

**전제 조건**:
- WebP 형식 이미지 파일 준비

**테스트 단계**:
1. WebP 이미지 파일 선택
2. Alt 텍스트 입력
3. 업로드 버튼 클릭

**예상 결과**:
- ✅ WebP 파일이 정상적으로 업로드됨
- ✅ 이미지 메타데이터가 올바르게 추출됨

---

### 1.2 자동 크롭 기능

#### 시나리오 1.2.1: 자동 크롭 활성화 시 16:9 비율로 변환
**목적**: 자동 크롭 기능이 이미지를 16:9 비율로 변환하는지 확인

**전제 조건**:
- 4:3 비율 이미지 준비 (예: 1600x1200)

**테스트 단계**:
1. 4:3 비율 이미지 선택
2. "자동 크롭" 체크박스 활성화 확인
3. 업로드

**예상 결과**:
- ✅ 이미지가 1920x1080 (16:9)로 크롭됨
- ✅ 중앙을 기준으로 크롭됨
- ✅ DB에 저장된 width: 1920, height: 1080

**검증 방법**:
```bash
# 업로드된 이미지 메타데이터 확인
sqlite3 data/local.db "SELECT width, height FROM hero_images ORDER BY id DESC LIMIT 1;"
```

---

#### 시나리오 1.2.2: 자동 크롭 비활성화 시 원본 유지
**목적**: 자동 크롭을 비활성화하면 원본 비율이 유지되는지 확인

**전제 조건**:
- 임의 비율 이미지 준비 (예: 1024x768)

**테스트 단계**:
1. 이미지 선택
2. "자동 크롭" 체크박스 **비활성화**
3. 업로드

**예상 결과**:
- ✅ 원본 이미지 비율 유지 (1024x768)
- ✅ DB에 저장된 width: 1024, height: 768

---

### 1.3 이미지 삭제 기능

#### 시나리오 1.3.1: 비활성 이미지 삭제
**목적**: 활성화되지 않은 이미지를 삭제할 수 있는지 확인

**전제 조건**:
- 최소 2개 이상의 이미지 업로드 (1개는 활성, 1개는 비활성)

**테스트 단계**:
1. 이미지 목록에서 비활성 이미지 찾기
2. "삭제" 버튼 클릭
3. 확인 다이얼로그에서 "확인" 클릭

**예상 결과**:
- ✅ "정말 삭제하시겠습니까?" 확인 메시지 표시
- ✅ 삭제 성공 메시지 표시
- ✅ 이미지 목록에서 제거됨
- ✅ GCS에서도 파일 삭제됨

---

#### 시나리오 1.3.2: 활성 이미지 삭제 시도 (실패)
**목적**: 활성 이미지는 삭제할 수 없음을 확인

**테스트 단계**:
1. 활성 이미지의 "삭제" 버튼 클릭 시도

**예상 결과**:
- ✅ "삭제" 버튼이 비활성화 상태
- ✅ 버튼 텍스트: "활성 이미지"
- ✅ 클릭 시 "활성 이미지는 삭제할 수 없습니다." 알림 표시

---

## 2. 사용자 시나리오 테스트

### 시나리오 2.1: 신규 관리자의 첫 이미지 등록

**사용자 스토리**:
> 관리자로서, 처음 웹사이트에 히어로 이미지를 등록하고 싶습니다.

**테스트 단계**:
1. 빈 데이터베이스 상태에서 시작
2. `/admin/hero-images` 페이지 접속
3. "업로드된 이미지가 없습니다." 메시지 확인
4. 첫 이미지 업로드 (1920x1080, JPG)
5. 홈페이지(`/`) 방문하여 이미지 표시 확인

**예상 결과**:
- ✅ 첫 이미지가 자동으로 활성화됨
- ✅ 홈페이지에 즉시 반영됨 (ISR 캐시 무효화)
- ✅ 이미지가 16:9 비율로 표시됨

---

### 시나리오 2.2: 계절별 이미지 교체

**사용자 스토리**:
> 관리자로서, 계절에 맞게 히어로 이미지를 교체하고 싶습니다.

**테스트 단계**:
1. 기존 활성 이미지 1개 존재
2. 새로운 계절 이미지 업로드
3. 이전 이미지가 자동으로 비활성화되는지 확인
4. 이전 이미지 삭제

**예상 결과**:
- ✅ 새 이미지 업로드 시 이전 활성 이미지가 자동 비활성화
- ✅ 새 이미지만 "활성" 배지 표시
- ✅ 홈페이지에 새 이미지 반영
- ✅ 비활성화된 이전 이미지 삭제 가능

---

### 시나리오 2.3: 모바일에서 관리자 작업

**사용자 스토리**:
> 관리자로서, 모바일 기기에서도 이미지를 관리하고 싶습니다.

**테스트 단계**:
1. 모바일 뷰포트 설정 (375x667)
2. `/admin/hero-images` 페이지 접속
3. 이미지 업로드 시도
4. 이미지 목록 확인

**예상 결과**:
- ✅ 모든 UI 요소가 모바일에 최적화되어 표시
- ✅ 파일 선택 버튼 작동
- ✅ 업로드 진행률 표시
- ✅ 이미지 목록이 그리드에서 세로 스택으로 변경

---

## 3. 엣지 케이스 및 에러 처리

### 시나리오 3.1: 유효성 검증 실패

#### 3.1.1: 파일 크기 초과 (2MB 제한)
**테스트 단계**:
1. 3MB 크기의 이미지 선택
2. 업로드 시도

**예상 결과**:
- ✅ "파일 크기가 2MB를 초과합니다." 에러 메시지
- ✅ 업로드 중단
- ✅ 에러 메시지가 빨간색 배경에 표시

---

#### 3.1.2: 지원하지 않는 파일 형식
**테스트 단계**:
1. GIF 파일 선택
2. 업로드 시도

**예상 결과**:
- ✅ "지원하지 않는 파일 형식입니다. JPG, PNG, WebP만 허용됩니다." 에러 메시지
- ✅ 업로드 중단

---

#### 3.1.3: Alt 텍스트 너무 짧음 (10자 미만)
**테스트 단계**:
1. 유효한 이미지 선택
2. Alt 텍스트에 "테스트" (3자) 입력
3. 업로드 시도

**예상 결과**:
- ✅ HTML5 validation 에러 표시
- ✅ "최소 10자 이상 입력해주세요" 메시지
- ✅ 폼 제출 차단

---

#### 3.1.4: 이미지 해상도 너무 낮음 (800x600 미만)
**테스트 단계**:
1. 640x480 이미지 선택
2. 업로드 시도

**예상 결과**:
- ✅ "이미지 해상도가 너무 낮습니다. 최소 800x600 이상이어야 합니다." 에러 메시지

---

### 시나리오 3.2: 네트워크 에러 처리

#### 3.2.1: GCS 업로드 실패
**테스트 단계**:
1. GCS 인증 정보 임시 제거 또는 잘못된 값 설정
2. 이미지 업로드 시도

**예상 결과**:
- ✅ "업로드 실패: GCS 업로드에 실패했습니다." 에러 메시지
- ✅ DB에 upload_status: 'failed' 저장
- ✅ 재시도 옵션 제공 (3회까지)

---

#### 3.2.2: 네트워크 연결 끊김
**테스트 단계**:
1. Chrome DevTools에서 네트워크 Offline 설정
2. 이미지 업로드 시도

**예상 결과**:
- ✅ "네트워크 연결을 확인해주세요." 에러 메시지
- ✅ 업로드 진행률이 중단됨

---

### 시나리오 3.3: 동시성 문제

#### 3.3.1: 두 관리자가 동시에 이미지 업로드
**테스트 단계**:
1. 두 개의 브라우저 탭 열기
2. 각 탭에서 거의 동시에 다른 이미지 업로드

**예상 결과**:
- ✅ 두 이미지 모두 업로드됨
- ✅ 마지막에 업로드된 이미지만 활성화
- ✅ 이전 이미지는 자동 비활성화

---

## 4. 통합 테스트 시나리오

### 시나리오 4.1: 전체 워크플로우 테스트

**목적**: 이미지 업로드부터 홈페이지 표시까지 전체 흐름 검증

**테스트 단계**:
1. **업로드**: Admin 페이지에서 이미지 업로드
2. **메타데이터 추출**: Sharp로 width, height 추출 확인
3. **크롭**: 16:9 비율로 자동 크롭 확인
4. **GCS 업로드**: Google Cloud Storage에 파일 업로드 확인
5. **DB 저장**: SQLite에 메타데이터 저장 확인
6. **활성화**: isActive = true 설정 확인
7. **캐시 무효화**: ISR 캐시 revalidate 호출 확인
8. **홈페이지 표시**: `/` 페이지에서 새 이미지 표시 확인

**검증 방법**:
```bash
# 1. DB 확인
sqlite3 data/local.db "SELECT * FROM hero_images ORDER BY id DESC LIMIT 1;"

# 2. GCS 확인 (파일 존재 여부)
gsutil ls gs://choi-pd-hero-images/hero/

# 3. 홈페이지 확인
curl http://localhost:3000/ | grep "hero-"
```

---

### 시나리오 4.2: 이미지 교체 워크플로우

**테스트 단계**:
1. 첫 번째 이미지 업로드 및 활성화
2. 홈페이지에서 첫 번째 이미지 표시 확인
3. 두 번째 이미지 업로드
4. 첫 번째 이미지 자동 비활성화 확인
5. 홈페이지에서 두 번째 이미지 표시 확인
6. 첫 번째 이미지 삭제
7. GCS에서도 삭제 확인

---

## 5. 성능 테스트 시나리오

### 시나리오 5.1: 대용량 이미지 업로드

**목적**: 2MB 제한 내에서 최대 크기 이미지 처리 성능 확인

**테스트 단계**:
1. 정확히 2MB 크기의 이미지 업로드
2. 업로드 시간 측정

**예상 결과**:
- ✅ 업로드 완료까지 10초 이내
- ✅ Sharp 이미지 처리 3초 이내
- ✅ GCS 업로드 5초 이내

---

### 시나리오 5.2: 연속 업로드

**목적**: 여러 이미지를 연속으로 업로드할 때 성능 저하 없음을 확인

**테스트 단계**:
1. 5개 이미지를 연속으로 업로드 (각각 1MB)
2. 각 업로드 시간 측정

**예상 결과**:
- ✅ 각 업로드가 독립적으로 처리됨
- ✅ 업로드 시간이 일정하게 유지됨 (±2초 이내)

---

### 시나리오 5.3: Lighthouse 성능 점수

**테스트 단계**:
```bash
npm run test:lighthouse
```

**예상 결과**:
- ✅ Performance: 70점 이상
- ✅ Accessibility: 90점 이상
- ✅ Best Practices: 80점 이상
- ✅ SEO: 80점 이상

---

## 6. 접근성 테스트 시나리오

### 시나리오 6.1: 스크린 리더 사용

**목적**: 시각 장애인도 이미지 관리 기능을 사용할 수 있는지 확인

**도구**: NVDA 또는 JAWS

**테스트 단계**:
1. 스크린 리더 활성화
2. Admin 페이지 탐색
3. 파일 입력 필드 찾기
4. Alt 텍스트 입력 필드 찾기
5. 업로드 버튼 찾기 및 클릭

**예상 결과**:
- ✅ 모든 폼 필드에 적절한 label 연결
- ✅ 업로드 버튼에 명확한 설명
- ✅ 에러 메시지가 스크린 리더로 읽힘

---

### 시나리오 6.2: 키보드 네비게이션

**목적**: 마우스 없이 키보드만으로 모든 기능 사용 가능한지 확인

**테스트 단계**:
1. Tab 키로 폼 필드 이동
2. Enter 키로 파일 선택 다이얼로그 열기
3. Tab으로 업로드 버튼 이동
4. Enter로 업로드 실행

**예상 결과**:
- ✅ 논리적인 Tab 순서
- ✅ 포커스 표시가 명확함
- ✅ 모든 인터랙티브 요소 접근 가능

---

### 시나리오 6.3: 색상 대비

**목적**: 색각 이상자도 UI를 사용할 수 있는지 확인

**도구**: Chrome DevTools Lighthouse, axe DevTools

**테스트 단계**:
```bash
npm run test:e2e -- accessibility.spec.ts
```

**예상 결과**:
- ✅ 텍스트 대비율 4.5:1 이상
- ✅ 버튼 대비율 3:1 이상
- ✅ axe 자동화 테스트 통과

---

## 7. 보안 테스트 시나리오

### 시나리오 7.1: 파일 형식 검증 우회 시도

**목적**: 악성 파일 업로드를 방지할 수 있는지 확인

**테스트 단계**:
1. PHP 파일의 확장자를 .jpg로 변경
2. 업로드 시도

**예상 결과**:
- ✅ MIME 타입 검증으로 차단
- ✅ "유효하지 않은 이미지 파일입니다." 에러 메시지

---

### 시나리오 7.2: XSS 공격 시도 (Alt 텍스트)

**목적**: Alt 텍스트를 통한 XSS 공격 방지 확인

**테스트 단계**:
1. Alt 텍스트에 `<script>alert('XSS')</script>` 입력
2. 업로드
3. 홈페이지에서 이미지 확인

**예상 결과**:
- ✅ 스크립트가 실행되지 않음
- ✅ Alt 텍스트가 이스케이프되어 저장됨
- ✅ 홈페이지에서 텍스트로만 표시됨

---

### 시나리오 7.3: SQL 인젝션 시도

**목적**: SQL 인젝션 공격 방지 확인

**테스트 단계**:
1. Alt 텍스트에 `'; DROP TABLE hero_images; --` 입력
2. 업로드 시도

**예상 결과**:
- ✅ Drizzle ORM의 파라미터화된 쿼리로 안전하게 처리됨
- ✅ 정상적으로 텍스트로 저장됨
- ✅ DB 테이블이 삭제되지 않음

---

## 테스트 체크리스트

### Pre-Release 필수 테스트
- [ ] 모든 자동화 테스트 통과 (Unit + E2E)
- [ ] Lighthouse 점수 목표 달성
- [ ] 접근성 자동화 테스트 통과
- [ ] 수동 테스트: 이미지 업로드 → 홈페이지 표시
- [ ] 수동 테스트: 이미지 삭제 → GCS 확인
- [ ] 모바일 반응형 테스트
- [ ] 다양한 이미지 형식 테스트 (JPG, PNG, WebP)
- [ ] 브라우저 호환성 테스트 (Chrome, Safari, Firefox)

### 릴리스 후 모니터링
- [ ] 실제 사용자 업로드 성공률 95% 이상
- [ ] 평균 업로드 시간 10초 이내
- [ ] GCS 저장 성공률 99% 이상
- [ ] 홈페이지 LCP 2.5초 이하 유지

---

## 테스트 실행 가이드

### 자동화 테스트 실행
```bash
# 모든 테스트 한번에 실행
npm test && npm run test:e2e && npm run test:lighthouse

# 개별 실행
npm test                    # Unit tests
npm run test:e2e            # E2E tests
npm run test:lighthouse     # Performance tests
```

### 수동 테스트 환경 설정
```bash
# 1. 개발 서버 실행
npm run dev

# 2. 데이터베이스 초기화 (필요시)
rm data/local.db
npm run db:push

# 3. 테스트 이미지 준비
# - test-images/ 폴더에 다양한 크기/형식 이미지 준비
```

### 버그 리포팅 템플릿
```markdown
## 버그 제목
[간단한 설명]

## 재현 단계
1.
2.
3.

## 예상 결과
[무엇이 일어나야 하는가]

## 실제 결과
[무엇이 일어났는가]

## 환경
- Browser:
- OS:
- Screen size:

## 스크린샷
[첨부]
```
